---
icon: pen-to-square
date: 2023-07-15
category:
  - python
tag:
  - __new__
  - __init__
---

# `__new__`和`__init__`方法



###  一、`__new__` 方法是什么？

`__new__` 方法是Python中的一个特殊的静态方法，用于创建类的新实例。它是在`__init__`方法之前被调用的，并且负责返回类的新实例。`__new__`方法通常不需要被直接调用，而是由Python解释器在实例化对象时自动调用。

`__new__`方法的主要作用是创建一个新对象，而`__init__`方法则用于初始化这个新创建的对象。`__new__`方法只接收类本身（通常用`cls`表示）作为第一个参数，后面可以跟任意数量的参数，这些参数将传递给`__init__`方法。

```python
class Singleton:
    _instance = None

    def __new__(cls, *args, **kwargs):
        if cls._instance is None:
            cls._instance = super(Singleton, cls).__new__(cls)
        return cls._instance

    def __init__(self):
        pass  # 这里可以初始化实例的属性

# 创建Singleton的两个实例
singleton1 = Singleton()
singleton2 = Singleton()

# 检查两个实例是否是同一个对象
print(singleton1 is singleton2)  # 输出: True
```

`__new__`方法通常用于以下情况：

1. **控制对象的创建**：比如实现单例模式。
2. **继承不可变类型**：比如`int`、`str`、`tuple`等，因为这些类型的实例是不可变的，所以需要在`__new__`方法中创建新实例。
3. **多态实例化**：根据传入的参数动态决定创建哪种类型的对象。

在大多数情况下，你不需要自定义`__new__`方法，除非你有特殊的对象创建需求。通常情况下，只需要定义`__init__`方法来初始化对象即可。



### 二、`__init__ `方法是什么？

`__init__` 方法是Python中类的构造器，用于在创建类的新实例时初始化对象。当你创建一个新对象时，Python会自动调用`__init__`方法。这个方法通常用于设置对象的初始状态，比如给对象的属性赋初始值。

`__init__`方法的第一个参数始终是`self`，它代表类的实例本身，允许我们访问类的属性和方法。在`__init__`方法中，你可以定义其他参数来接收初始化数据，并根据这些数据来设置对象的状态。

如果你不显式定义`__init__`方法，Python会提供一个默认的`__init__`方法，这个默认的方法什么也不做。自定义`__init__`方法可以让你控制对象创建时的行为。



### 三、`__new__` 的作用

依照Python官方文档的说法，__new__方法主要是当你继承一些不可变的class时(比如int, str, tuple)， 提供给你一个自定义这些类的实例化过程的途径。 首先我们来看一下第一个功能，具体我们可以用int来作为一个例子： 假如我们需要一个永远都是正数的整数类型，通过集成int，我们可能会写出这样的代码：

工厂模式的实现

```python
class Fruit(object):
    def __init__(self):
        pass

    def print_color(self):
        pass

class Apple(Fruit):
    def __init__(self):
        pass

    def print_color(self):
        print("apple is in red")

class Orange(Fruit):
    def __init__(self):
        pass

    def print_color(self):
        print("orange is in orange")

class FruitFactory(object):
    fruits = {"apple": Apple, "orange": Orange}

    def __new__(cls, name):
        if name in cls.fruits.keys():
            return cls.fruits[name]()
        else:
            return Fruit()

fruit1 = FruitFactory("apple")
fruit2 = FruitFactory("orange")
fruit1.print_color()    
fruit2.print_color()    
```



### 四、`__init__`与`__new__`的区别

从上述过程中我们可以发现，这两个方法区别在于：

- 作用区别，`init`实例级别，`new`类级别
  - 1.`__init__` 通常用于初始化一个新实例，控制这个初始化的过程，比如添加一些属性， 做一些额外的操作，发生在类实例被创建完以后。它是实例级别的方法。
  - 2.`__new__` 通常用于控制生成一个类实例的过程。它是类级别的方法

- 执行顺序，先new 后`init`

  



